@inherits LayoutComponentBase
@using PluScript.Services
@inject NavigationManager Navigation
@inject AuthService AuthService
@implements IDisposable

<div>
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
		<div class="container-fluid">
			<a class="navbar-brand" href="/">PluScript</a>
			<div class="navbar-nav ms-auto d-flex align-items-center gap-2">
				@if (AuthService.IsAuthenticated)
				{
					<a class="nav-link" href="/admin/credentials">Admin</a>
					<button class="btn btn-outline-light btn-sm" @onclick="Logout">
						<i class="bi bi-box-arrow-right"></i>
					</button>
				}
				else
				{
					<a class="nav-link" href="/admin/credentials">Admin login</a>
				}
			</div>
		</div>
	</nav>
	
	<main style="padding-top: 60px;">
		<article class="content px-4">
			@Body
		</article>
	</main>
</div>

<div id="blazor-error-ui" data-nosnippet>
	An unhandled error has occurred.
	<a href="." class="reload">Reload</a>
	<span class="dismiss">🗙</span>
</div>

@code {
    protected override void OnInitialized()
    {
        AuthService.OnAuthStateChanged += StateHasChanged;
    }

    private void Logout()
    {
        AuthService.Logout();
    }

    public void Dispose()
    {
        AuthService.OnAuthStateChanged -= StateHasChanged;
    }
}
